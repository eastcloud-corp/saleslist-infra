# SalesList ユーザーガイド（一般ユーザー向け）

> **対象**: 営業担当、オペレーター
> **目的**: 企業管理・案件管理の日常操作とレビュー導線の基本手順をまとめています。

## 1. 企業管理

### 1.1 画面構成

| ブロック | 説明 | チェックポイント |
| --- | --- | --- |
| ヘッダー | CSV インポート／エクスポート、案件一括追加、選択解除など主要アクションを配置 | 選択中件数が表示されているか確認 |
| フィルタバー | 業種・所在地・ステータスなどで絞り込み | NG 状態の企業を除外できているか |
| リスト | ページング・複数選択に対応、列ごとのソートが可能 | CSV 取り込み後に内容が反映されているか |
| アクション領域 | 自動取得レビューへの導線、サンプル生成など | 未レビュー件数バッジで保留状況を把握 |

### 1.2 CSV インポート
- ファイル選択後に検証が行われ、エラーは詳細メッセージで表示されます。
- 正常終了後はトースト通知 → リスト自動更新。必要に応じて「最終更新日時」を確認してください。
- NG 判定や重複データがあれば、会社情報自動取得レビューに候補として流れます。

### 1.3 サンプル候補の生成（検証環境向け）
- 「サンプル候補生成」ボタンを押すとダミーの候補データが投入され、レビュー画面の挙動を確認できます。
- 本番環境では利用しません。

## 2. AI 補完（PowerPlexy）

### 2.1 概要
- PowerPlexy API を用いて、担当者名・所在地・事業内容などの不足項目を補完します。
- 1 回の手動実行で最大 **`POWERPLEXY_DAILY_RECORD_LIMIT`** 件まで処理します（未設定の場合は月間コール上限を当月の日数で割った値が自動計算されます）。
- 月間の上限は **3,000 リクエスト / 150 USD**（`POWERPLEXY_MONTHLY_CALL_LIMIT` が未設定の場合は `POWERPLEXY_MONTHLY_COST_LIMIT` ÷ `POWERPLEXY_COST_PER_REQUEST` で算出されます）。
- 1 リクエストあたりの目安コストは **0.05 USD**（`POWERPLEXY_COST_PER_REQUEST`）。

### 2.2 手動補完の流れ
1. サイドバー「データ収集履歴」を開き、手動トリガーで「AI補完（PowerPlexy）」を選択します。
2. 可能な限り `企業ID` を指定し、対象企業を限定して実行してください（未指定の場合は不足項目のある企業を上限まで処理します）。
3. 実行後は履歴テーブルに結果が追加され、会社情報レビュー画面に候補値として流れます。
4. 画面上部に今月の実行回数／コスト残高が表示されるので、上限に近付いていないか確認します。

### 2.3 利用上の注意
- 月間上限に達すると自動的にスキップされ、Slack/メールで通知されます。必要に応じて翌月まで待機するか管理者に連絡してください。
- 誤操作で大量のリクエストを消費しないよう、基本は「不足項目が判明している企業 ID をピンポイントで指定する」運用を推奨します。
- API キーや上限値は `.env` の `POWERPLEXY_*` 項目で管理されます。変更が必要な場合は運用チームに依頼してください。
- バッチ実行時は **まだ一度も AI 補完が走っていない企業**（`AI最終補完日時` が未設定）から優先的に処理され、残り枠があれば過去に補完した企業の不足項目も自動で再補完されます。

### 2.4 リクエスト上限の算出とスキップ条件
- **月間上限**: `POWERPLEXY_MONTHLY_CALL_LIMIT` を設定していない場合、`POWERPLEXY_MONTHLY_COST_LIMIT ÷ POWERPLEXY_COST_PER_REQUEST` の整数値で自動計算されます（例: 150 USD ÷ 0.05 USD = 3,000 リクエスト）。
- **日次上限**: `POWERPLEXY_DAILY_RECORD_LIMIT` が未設定なら「月間上限 ÷ 当月の日数」（小数点切り捨て、最低 1 件）で算出します。
- **優先順位**: まず `AI最終補完日時` が未設定の企業、続いて補完日時が古い企業を対象に、欠損項目が検出された順で補完します。
- **スキップ条件**:
  - 推定コストまたはリクエスト数が月間上限に達している場合。
  - 処理対象（欠損項目のある企業）が 1 件も見つからない場合。
  - PowerPlexy の API キーが未設定、もしくは API 呼び出し中に致命的なエラーが発生した場合。

## 3. 会社情報自動取得レビュー

### 3.1 手順
1. 企業管理から右上「自動取得レビュー」ボタンをクリック。
2. レビューしたい企業を選択（担当者や未レビュー件数で絞り込み可能）。
3. 現行値と候補値を比較し、「承認」「否認」「修正承認」から選択。
4. 承認した値のみ企業マスタに反映され、履歴タブに記録されます。

### 3.2 操作のこつ
- 候補は優先度や信頼度で色分けされているため、重要項目から処理すると効率的です。
- スキップした内容はメモを残しておくと、次回レビューがスムーズになります。

## 4. 案件管理・NG 管理

### 4.1 NG リスト
- クライアント詳細 → 「NG リスト」タブで CSV インポート＆手動追加ができます。
- NG 登録された企業は案件候補選定画面でグレーアウトされ選択できません。

### 4.2 案件候補選定
- クライアント詳細 → 「候補を選ぶ」で企業を複数選択し、既存案件へ追加します。
- NG 状態の企業は警告バッジが表示されるので、その場で確認・解除を検討してください。

### 4.3 案件一覧
- 案件一覧画面（サイドバー「案件」）で案件情報を確認。編集モードに入るとページロックがかかり、他ユーザーには「編集中」のトーストが表示されます。
- 編集が終わったら必ず「編集完了」を押し、ロックを解除してください。

## 5. よくある質問（抜粋）

**Q. CSV インポート後に反映されない行がある。**  
A. NG 登録や重複が原因の可能性があります。レビュー画面またはログを確認してください。

**Q. NG リストを解除したのに、案件候補で選択できない。**  
A. 閲覧中のフィルタが適用されたままになっていないか確認し、画面を更新してください。

---
